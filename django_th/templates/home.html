{% extends "base.html" %}
{% load static %}
{% load url from future %}
{% load i18n %}
{% load django_th_extras %}

{% block title %}{% if user.is_authenticated %}{% trans "My Triggers" %} - {{ user.username }} - {{ current_site.name }}{% else %}{% trans "Home" %} - {{ current_site.name }}{% endif %}{% endblock %}

{% block content %}

{% if user.is_authenticated %}
        <div class="span12 row">
            <div class="span7">
                <h2>{% trans "My Triggers" %}</h2>
            </div>
            <div class="span4 trigger-summary">            
                <span class="label label-info">{{ nb_triggers.enabled }}</span> {%  trans "activated triggers" %}
                <span class="label label-important">{{ nb_triggers.disabled }}</span> {%  trans "deactivated triggers" %}
            </div>        
        </div>
{% if triggers_list %}
        {% if is_paginated %}
        <div class="span12 pagination">
            <ul>
                {% if page_obj.has_previous %}
                    <li><a href="{% url 'home' %}?page={{ page_obj.previous_page_number }}">{% trans "previous" %}</a></li>
                {% endif %}
                    <li class="active"><a >
                    {% blocktrans with page_number=page_obj.number total_of_pages=page_obj.paginator.num_pages %}
                    Page {{ page_number }} of {{ total_of_pages }}
                    {% endblocktrans %}</a>
                    </li>
                {% if page_obj.has_next %}
                    <li><a href="{% url 'home' %}?page={{ page_obj.next_page_number }}">{% trans "next" %}</a></li>
                {% endif %}
            </ul>
        </div>
    {% endif %}
    {% for trigger in triggers_list %}
        <article>
        <div class="trigger-record {% if trigger.status %}trigger-enable{% else %}trigger-disable{% endif %} span12">
            <div class="span7 trigger-text">
                <i class="icon-{{ trigger.provider.name|service_readable|lower }}"></i> <i class="icon-from-to"></i> <i class="icon-{{ trigger.consummer.name|service_readable|lower }}"></i>
                <h3><a href="{% url 'edit_trigger' trigger.id %}" title="{% trans "Edit your trigger " %} {{ trigger.provider.name|service_readable|safe|escape }} => {{ trigger.consummer.name|service_readable|safe|escape }}">{{ trigger.description|safe|escape }}</a></h3>
            </div>
            <div class="span4">
                <br/>
                <a class="btn btn-large" href="{% url 'edit_trigger' trigger.id %}" title="{% trans "Edit this trigger" %}"><i class="icon-pencil"></i> {% trans "Edit it" %}</a>
                {% if trigger.status %}
                <a class="btn btn-large btn-primary active" href="{% url 'trigger_on_off' trigger.id %}" title="{% trans 'Set this trigger off' %}"><i class="icon-off icon-white"></i> {% trans "Turn off" %}</a>

                {% else %}
                <a class="btn btn-large btn-primary disabled" href="{% url 'trigger_on_off' trigger.id %}" title="{% trans 'Set this trigger on' %}"><i class="icon-off icon-white"></i> {% trans "Turn on" %}</a>

                {% endif %}                    
                <a class="btn btn-large btn-danger" href="{% url 'delete_trigger' trigger.id %}" title="{% trans "Delete this trigger ?" %}"><i class="icon-trash icon-white"></i> {% trans "Delete it" %}</a><br/>
                
            </div>
            <footer>
            <div class="span12">
                    <p><i class="icon-calendar"></i>{% trans "Created" %} {{ trigger.date_created }} - 
                    <i class="icon-calendar"></i>{% trans "Triggered" %} {% if trigger.date_triggered %}{{ trigger.date_triggered }}{% else %} {% trans "Never triggered" %}{% endif %}</p>
            </div>  
            </footer>                  
        </div>
        </article>
    {% endfor %}
    {% if is_paginated %}
        <div class="span12 pagination">
            <ul>
                {% if page_obj.has_previous %}
                    <li><a href="{% url 'home' %}?page={{ page_obj.previous_page_number }}">{% trans "previous" %}</a></li>
                {% endif %}
                    <li class="active"><a >
                    {% blocktrans with page_number=page_obj.number total_of_pages=page_obj.paginator.num_pages %}
                    Page {{ page_number }} of {{ total_of_pages }}
                    {% endblocktrans %}</a>
                    </li>
                {% if page_obj.has_next %}
                    <li><a href="{% url 'home' %}?page={{ page_obj.next_page_number }}">{% trans "next" %}</a></li>
                {% endif %}
            </ul>
        </div>
    {% endif %}
{% else %}
        <div class="trigger-record span12">
            {% trans 'No trigger yet' %}
        </div>
{% endif %}
{% else %}
            <div class="hero-unit">
                <p>
                    <strong>Trigger Happy</strong> is up !
                </p>
                <p>Let's register !</p>
                <p>Have Fun</p>
                <a class="btn btn-info" href="{% url 'registration_register' %}">{% trans "Register" %}</a>                 
                <a class="btn btn-primary" href="{% url 'login' %}">{% trans "Log in" %}</a>        
            </div>
{% endif %}
    
{% endblock %}
